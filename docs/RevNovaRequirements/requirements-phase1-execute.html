<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Phase 1 - Migration Execution | RevNova Requirements</title>
    <link rel="stylesheet" href="../styles.css">
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; }
        .requirements-layout{display:flex;min-height:calc(100vh - 80px);margin-top:80px}
        .sidebar{width:280px;background:#f8f9fa;border-right:1px solid #e0e0e0;padding:2rem 0;position:fixed;left:0;top:80px;height:calc(100vh - 80px);overflow-y:auto;z-index:100}
        .sidebar h3{padding:0 1.5rem;font-size:0.85rem;color:#666;text-transform:uppercase;letter-spacing:0.5px;margin:1.5rem 0 0.5rem}
        .sidebar ul{list-style:none;padding:0;margin:0}
        .sidebar ul li a{display:block;padding:0.6rem 1.5rem;color:#333;text-decoration:none;font-size:0.95rem;transition:all 0.2s}
        .sidebar ul li a:hover{background:#e9ecef;color:#11998e}
        .sidebar ul li a.active{background:#11998e;color:#fff;font-weight:500}
        .sidebar ul ul li a{padding-left:2.5rem;font-size:0.9rem}
        .main-content{flex:1;margin-left:280px;padding:3rem;background:#fff;min-width:0}
        .page-header{background:linear-gradient(135deg,#11998e 0%,#38ef7d 100%);color:#fff;padding:3rem;border-radius:12px;margin-bottom:3rem}
        .section-box{background:#fff;border:2px solid #e0e0e0;padding:2.5rem;margin:2rem 0;border-radius:12px}
        .section-box h3{color:#11998e;margin-top:0;border-bottom:2px solid #38ef7d;padding-bottom:0.5rem}
        table{width:100%;border-collapse:collapse;margin:1.5rem 0}
        th,td{border:1px solid #ddd;padding:12px;text-align:left}
        th{background:linear-gradient(135deg,#11998e 0%,#38ef7d 100%);color:#fff;font-weight:600;font-size:0.85rem}
        .badge-functional{background:#11998e;color:#fff;padding:0.3rem 0.6rem;border-radius:12px;font-size:0.75rem;font-weight:600}
        .badge-technical{background:#e74c3c;color:#fff;padding:0.3rem 0.6rem;border-radius:12px;font-size:0.75rem;font-weight:600}
    </style>
</head>
<body>
    <header>
        <div class="container header-container">
            <div class="nav-left">
                <a href="../index.html" class="logo"><div class="logo-box">RevNova</div></a>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../about-revnova.html">About RevNova</a></li>
                        <li><a href="../features.html">Features</a></li>
                        <li><a href="../pricing.html">Pricing</a></li>
                        <li><a href="requirements-home.html" class="active">RevNova Requirements</a></li>
                        <li><a href="../contact.html">Contact</a></li>
                    </ul>
                </nav>
            </div>
            <div class="header-right">
                <div class="country-selector"><span class="fi fi-us"></span></div>
                <a href="../login.html" class="btn btn-login">Login</a>
            </div>
        </div>
    </header>

    <div class="requirements-layout">
        <aside class="sidebar">
            <h3>Platform Vision</h3>
            <ul>
                <li><a href="requirements-home.html">RevNova Vision & Strategy</a></li>
                <li><a href="business-requirements.html">High Level Business Requirements</a></li>
                <li><a href="high-level-functional.html">High Level Functional Design</a></li>
            </ul>
            <h3>Phase 1 - Migration Wizard</h3>
            <ul>
                <li><a href="requirements-phase1-connect.html">1. Connection Wizard</a></li>
                <li><a href="requirements-phase1-analyze.html">2. Schema Analysis</a></li>
                <li><a href="requirements-phase1-mapping.html">3. Field Mapping</a></li>
                <li><a href="requirements-phase1-transform.html">4. Data Transformation</a></li>
                <li><a href="requirements-phase1-validate.html">5. Validation</a></li>
                <li><a href="requirements-phase1-execute.html" class="active">6. Migration Execution</a></li>
                <li><a href="requirements-phase1-test.html">7. Post-Migration Testing</a></li>
                <li><a href="requirements-phase1-technical.html">Technical Architecture</a></li>
                <li><a href="requirements-mapping.html">Complete Field Mapping</a></li>
            </ul>
        </aside>

        <main class="main-content">
            <div class="page-header">
                <h1>üöÄ Page 6: Migration Execution</h1>
                <p>Execute migration with configurable batch processing, parallel workers, real-time monitoring, pause/resume capabilities</p>
            </div>

            <section class="section-box">
                <h3><span class="badge-functional">Functional</span> Execution Configuration</h3>
                <table>
                    <tr><th>Configuration</th><th>Options</th><th>Recommended Value</th></tr>
                    <tr><td><strong>Batch Size</strong></td><td>200 / 500 / 1000 / 2000 / 5000 / 10000</td><td>2000 (balance speed vs API limits)</td></tr>
                    <tr><td><strong>Parallel Workers</strong></td><td>1 / 2 / 4 / 8 / 16</td><td>4 workers (max throughput without overwhelming target)</td></tr>
                    <tr><td><strong>Retry Strategy</strong></td><td>None / Auto-retry transient errors / Retry all failures</td><td>Auto-retry transient errors (3 attempts)</td></tr>
                    <tr><td><strong>Error Handling</strong></td><td>Stop on first error / Continue with errors</td><td>Continue with errors (log and proceed)</td></tr>
                    <tr><td><strong>Execution Mode</strong></td><td>Full Migration / Test Run (100 records)</td><td>Test Run first, then Full Migration</td></tr>
                </table>
            </section>

            <section class="section-box">
                <h3><span class="badge-functional">Functional</span> Real-Time Monitoring Dashboard</h3>
                <table>
                    <tr><th>Requirement ID</th><th>Description</th></tr>
                    <tr><td>FR-EXEC-001</td><td>Display progress bar: "Migrating 12,450 / 50,000 records (24.9%)"</td></tr>
                    <tr><td>FR-EXEC-002</td><td>Show per-batch status: Batch #12 - Success (2000 records), Batch #13 - In Progress (1,234 / 2000)</td></tr>
                    <tr><td>FR-EXEC-003</td><td>Display worker status: Worker 1 (Active), Worker 2 (Active), Worker 3 (Idle), Worker 4 (Error - retrying)</td></tr>
                    <tr><td>FR-EXEC-004</td><td>Show success/failure counters: ‚úÖ 12,000 success | ‚ùå 450 failed | ‚è≥ 37,550 pending</td></tr>
                    <tr><td>FR-EXEC-005</td><td>Display estimated time remaining: "2 hours 15 minutes remaining (based on current throughput)"</td></tr>
                    <tr><td>FR-EXEC-006</td><td>Show throughput: "Current speed: 2,340 records/minute | Peak: 2,890 records/minute"</td></tr>
                </table>
            </section>

            <section class="section-box">
                <h3><span class="badge-functional">Functional</span> Pause/Resume & Rollback</h3>
                <table>
                    <tr><th>Feature</th><th>Description</th></tr>
                    <tr><td><strong>Pause</strong></td><td>Click "Pause" button ‚Üí current batches complete ‚Üí migration stops ‚Üí resume later from last checkpoint</td></tr>
                    <tr><td><strong>Resume</strong></td><td>Click "Resume" ‚Üí picks up from last successful batch ‚Üí continues with same configuration</td></tr>
                    <tr><td><strong>Rollback</strong></td><td>Click "Rollback" ‚Üí delete all migrated records from target ‚Üí restore to pre-migration state (requires backup)</td></tr>
                    <tr><td><strong>Auto-Checkpoint</strong></td><td>Save progress every 10 batches ‚Üí allows recovery from server crashes</td></tr>
                </table>
            </section>

            <section class="section-box">
                <h3><span class="badge-technical">Technical</span> Batch Processing Architecture</h3>
                <pre style="background:#2d2d2d;color:#f8f8f2;padding:1rem;border-radius:8px;overflow-x:auto">
// Bull Queue for parallel batch processing
const migrationQueue = new Bull('migration-queue', {
    redis: { host: 'redis', port: 6379 },
    settings: {
        maxStalledCount: 3, // Retry stalled jobs 3 times
        stalledInterval: 30000 // Check for stalled jobs every 30s
    }
});

// Add batches to queue
async function enqueueBatches(migrationId, totalRecords, batchSize, workerCount) {
    const batchCount = Math.ceil(totalRecords / batchSize);
    
    for (let i = 0; i < batchCount; i++) {
        await migrationQueue.add('process-batch', {
            migrationId,
            batchNumber: i + 1,
            offset: i * batchSize,
            limit: batchSize
        }, {
            attempts: 3, // Retry failed jobs 3 times
            backoff: { type: 'exponential', delay: 2000 }
        });
    }
}

// Worker processes batches
migrationQueue.process('process-batch', workerCount, async (job) => {
    const { migrationId, batchNumber, offset, limit } = job.data;
    
    // Fetch records from STG2
    const records = await fetchFromStaging(migrationId, offset, limit);
    
    // Load to target via Salesforce Bulk API
    const result = await salesforce.bulk.load('Product2', 'insert', records);
    
    // Update progress
    await updateMigrationProgress(migrationId, batchNumber, result);
    
    return result;
});
                </pre>
            </section>

            <section>
                <h2>Navigation</h2>
                <ul style="line-height:2">
                    <li><strong>Previous:</strong> <a href="requirements-phase1-validate.html">Page 5: Validation</a></li>
                    <li><strong>Next:</strong> <a href="requirements-phase1-test.html">Page 7: Post-Migration Testing</a></li>
                </ul>
            </section>
        </main>
    </div>
</body>
</html>
