<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Phase 1 - Data Transformation | RevNova Requirements</title>
    <link rel="stylesheet" href="../styles.css">
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; }
        .requirements-layout{display:flex;min-height:calc(100vh - 80px);margin-top:80px}
        .sidebar{width:280px;background:#f8f9fa;border-right:1px solid #e0e0e0;padding:2rem 0;position:fixed;left:0;top:80px;height:calc(100vh - 80px);overflow-y:auto;z-index:100}
        .sidebar h3{padding:0 1.5rem;font-size:0.85rem;color:#666;text-transform:uppercase;letter-spacing:0.5px;margin:1.5rem 0 0.5rem}
        .sidebar ul{list-style:none;padding:0;margin:0}
        .sidebar ul li a{display:block;padding:0.6rem 1.5rem;color:#333;text-decoration:none;font-size:0.95rem;transition:all 0.2s}
        .sidebar ul li a:hover{background:#e9ecef;color:#11998e}
        .sidebar ul li a.active{background:#11998e;color:#fff;font-weight:500}
        .sidebar ul ul li a{padding-left:2.5rem;font-size:0.9rem}
        .main-content{flex:1;margin-left:280px;padding:3rem;background:#fff;min-width:0}
        .page-header{background:linear-gradient(135deg,#11998e 0%,#38ef7d 100%);color:#fff;padding:3rem;border-radius:12px;margin-bottom:3rem;box-shadow:0 4px 15px rgba(17,153,142,0.2)}
        .page-header h1{margin:0 0 1rem 0;font-size:2.5rem;font-weight:700}
        .section-box{background:#fff;border:2px solid #e0e0e0;padding:2.5rem;margin:2rem 0;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.05)}
        .section-box h3{color:#11998e;margin-top:0;border-bottom:2px solid #38ef7d;padding-bottom:0.5rem}
        table{width:100%;border-collapse:collapse;margin:1.5rem 0;background:#fff;border-radius:8px;overflow:hidden}
        th,td{border:1px solid #ddd;padding:12px;text-align:left}
        th{background:linear-gradient(135deg,#11998e 0%,#38ef7d 100%);color:#fff;font-weight:600;text-transform:uppercase;font-size:0.85rem}
        .badge{display:inline-block;background:#667eea;color:#fff;padding:0.3rem 0.6rem;border-radius:12px;font-size:0.75rem;font-weight:600;margin:0.2rem}
        .badge-functional{background:#11998e}
        .badge-technical{background:#e74c3c}
    </style>
</head>
<body>
    <header>
        <div class="container header-container">
            <div class="nav-left">
                <a href="../index.html" class="logo"><div class="logo-box">RevNova</div></a>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../about-revnova.html">About RevNova</a></li>
                        <li><a href="../features.html">Features</a></li>
                        <li><a href="../pricing.html">Pricing</a></li>
                        <li><a href="requirements-home.html" class="active">RevNova Requirements</a></li>
                        <li><a href="../contact.html">Contact</a></li>
                    </ul>
                </nav>
            </div>
            <div class="header-right">
                <div class="country-selector"><span class="fi fi-us"></span></div>
                <a href="../login.html" class="btn btn-login">Login</a>
            </div>
        </div>
    </header>

    <div class="requirements-layout">
        <aside class="sidebar">
            <h3>Platform Vision</h3>
            <ul>
                <li><a href="requirements-home.html">RevNova Vision & Strategy</a></li>
                <li><a href="business-requirements.html">High Level Business Requirements</a></li>
                <li><a href="high-level-functional.html">High Level Functional Design</a></li>
            </ul>
            <h3>Phase 1 - Migration Wizard</h3>
            <ul>
                <li><a href="requirements-phase1-connect.html">1. Connection Wizard</a></li>
                <li><a href="requirements-phase1-analyze.html">2. Schema Analysis</a></li>
                <li><a href="requirements-phase1-mapping.html">3. Field Mapping</a></li>
                <li><a href="requirements-phase1-transform.html" class="active">4. Data Transformation</a></li>
                <li><a href="requirements-phase1-validate.html">5. Validation</a></li>
                <li><a href="requirements-phase1-execute.html">6. Migration Execution</a></li>
                <li><a href="requirements-phase1-test.html">7. Post-Migration Testing</a></li>
                <li><a href="requirements-phase1-technical.html">Technical Architecture</a></li>
                <li><a href="requirements-mapping.html">Complete Field Mapping</a></li>
            </ul>
        </aside>

        <main class="main-content">
            <div class="page-header">
                <h1>⚙️ Page 4: Data Transformation Rules</h1>
                <p>Define transformation rules for data normalization, calculation, concatenation, and conditional logic</p>
            </div>

            <section class="section-box">
                <h3><span class="badge badge-functional">Functional</span> Overview</h3>
                <p><strong>Purpose:</strong> Configure transformation rules to normalize, calculate, concatenate, split, or apply conditional logic to data before migration.</p>
                
                <h4>Transformation Types Supported</h4>
                <table>
                    <tr><th>Type</th><th>Description</th><th>Example</th></tr>
                    <tr><td><strong>Concatenate</strong></td><td>Combine multiple fields</td><td>FirstName + " " + LastName → FullName</td></tr>
                    <tr><td><strong>Split</strong></td><td>Extract substring/pattern</td><td>Email → extract username (before @)</td></tr>
                    <tr><td><strong>Normalize</strong></td><td>Format dates, currencies, phone</td><td>MM/DD/YYYY → YYYY-MM-DD</td></tr>
                    <tr><td><strong>Calculate</strong></td><td>Math formulas</td><td>Quantity * UnitPrice → TotalPrice</td></tr>
                    <tr><td><strong>Default Value</strong></td><td>Set value if null</td><td>Status = null → "Draft"</td></tr>
                    <tr><td><strong>Conditional</strong></td><td>IF/THEN/ELSE logic</td><td>IF Amount &gt; 1000 THEN "High" ELSE "Low"</td></tr>
                    <tr><td><strong>Lookup/Replace</strong></td><td>Value substitution table</td><td>"NY" → "New York"</td></tr>
                </table>
            </section>

            <section class="section-box">
                <h3><span class="badge badge-functional">Functional</span> Formula Builder UI</h3>
                <p><strong>FR-TRANS-001:</strong> Drag-drop formula builder with field picker, function library (30+ functions), and live preview</p>
                <table>
                    <tr><th>Requirement ID</th><th>Description</th></tr>
                    <tr><td>FR-TRANS-001.1</td><td>Formula builder supports text functions: CONCATENATE, SUBSTRING, UPPER, LOWER, TRIM, REPLACE</td></tr>
                    <tr><td>FR-TRANS-001.2</td><td>Formula builder supports date functions: DATE, DATEVALUE, YEAR, MONTH, DAY, ADDMONTHS</td></tr>
                    <tr><td>FR-TRANS-001.3</td><td>Formula builder supports math functions: SUM, MULTIPLY, DIVIDE, ROUND, ABS, MAX, MIN</td></tr>
                    <tr><td>FR-TRANS-001.4</td><td>Formula builder supports conditional logic: IF, AND, OR, NOT, ISBLANK, ISNULL</td></tr>
                    <tr><td>FR-TRANS-001.5</td><td>Live preview shows formula output for sample records (5 records displayed)</td></tr>
                    <tr><td>FR-TRANS-001.6</td><td>Validation checks for syntax errors, highlights errors in red with tooltip explanation</td></tr>
                </table>
            </section>

            <section class="section-box">
                <h3><span class="badge badge-technical">Technical</span> Transformation Engine</h3>
                <pre style="background:#2d2d2d;color:#f8f8f2;padding:1rem;border-radius:8px;overflow-x:auto">
CREATE TABLE transformation_rules (
    rule_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    migration_id UUID NOT NULL REFERENCES migrations(migration_id),
    target_field VARCHAR(255) NOT NULL,
    transformation_type VARCHAR(50) NOT NULL,
    formula TEXT, -- Salesforce-like formula syntax
    lookup_table JSONB, -- For lookup/replace transformations
    is_active BOOLEAN DEFAULT true,
    execution_order INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Example transformation execution
function applyTransformation(record, rule) {
    switch(rule.transformation_type) {
        case 'concatenate':
            return eval(rule.formula); // CONCATENATE(FirstName, " ", LastName)
        case 'normalize_date':
            return moment(record.date_field).format('YYYY-MM-DD');
        case 'conditional':
            return evaluateFormula(rule.formula, record);
        case 'lookup':
            return rule.lookup_table[record.source_value] || record.source_value;
    }
}
                </pre>
            </section>

            <section>
                <h2>Navigation</h2>
                <ul style="line-height:2">
                    <li><strong>Previous:</strong> <a href="requirements-phase1-mapping.html">Page 3: Field Mapping</a></li>
                    <li><strong>Next:</strong> <a href="requirements-phase1-validate.html">Page 5: Validation</a></li>
                </ul>
            </section>
        </main>
    </div>
</body>
</html>
