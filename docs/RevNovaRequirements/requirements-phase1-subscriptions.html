<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Phase 1 - Subscriptions Migration | RevNova Requirements</title>
    <link rel="stylesheet" href="../styles.css">
                <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; }
        
        .requirements-layout {
            display: flex;
            min-height: calc(100vh - 80px);
            margin-top: 80px;
        }
        
        /* Salesforce-style sidebar */
        .sidebar {
            width: 280px;
            background: #f4f6f9;
            border-right: 1px solid #c9c9c9;
            position: fixed;
            height: calc(100vh - 80px);
            overflow-y: auto;
            top: 80px;
            left: 0;
            z-index: 100;
        }
        
        .sidebar::-webkit-scrollbar { width: 8px; }
        .sidebar::-webkit-scrollbar-track { background: #f4f6f9; }
        .sidebar::-webkit-scrollbar-thumb { background: #c9c9c9; border-radius: 4px; }
        .sidebar::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
        
        .sidebar-nav { padding: 1rem 0; }
        
        .nav-section { margin-bottom: 0.25rem; }
        
        .nav-section-header {
            display: flex;
            align-items: center;
            padding: 0.5rem 1rem;
            font-size: 13px;
            font-weight: 600;
            color: #181818;
            background: none;
            border: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            transition: background 0.15s;
        }
        
        .nav-section-header:hover { background: #e5e5e5; }
        .nav-section-header.expanded { background: #e5e5e5; }
        
        .nav-section-icon {
            width: 16px;
            height: 16px;
            margin-right: 0.5rem;
            transition: transform 0.2s;
            flex-shrink: 0;
        }
        
        .nav-section-header.expanded .nav-section-icon { transform: rotate(90deg); }
        
        .nav-section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .nav-section-content.expanded { max-height: 2000px; }
        
        .nav-link {
            display: block;
            padding: 0.5rem 1rem 0.5rem 2.5rem;
            color: #006dcc;
            text-decoration: none;
            font-size: 13px;
            transition: background 0.15s;
        }
        
        .nav-link:hover {
            background: #e5e5e5;
            text-decoration: underline;
        }
        
        .nav-link.active {
            background: #1589ee;
            color: #fff;
            font-weight: 600;
        }
        
        .nav-link.active:hover {
            background: #0b5cab;
            text-decoration: none;
        }
        
        .nav-subsection { margin: 0.25rem 0; }
        
        .nav-subsection-header {
            display: flex;
            align-items: center;
            padding: 0.5rem 1rem 0.5rem 2.5rem;
            font-size: 13px;
            font-weight: 500;
            color: #181818;
            background: none;
            border: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            transition: background 0.15s;
        }
        
        .nav-subsection-header:hover { background: #e5e5e5; }
        .nav-subsection-header.expanded { background: #e5e5e5; }
        
        .nav-subsection-icon {
            width: 12px;
            height: 12px;
            margin-right: 0.5rem;
            transition: transform 0.2s;
            flex-shrink: 0;
        }
        
        .nav-subsection-header.expanded .nav-subsection-icon { transform: rotate(90deg); }
        
        .nav-subsection-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .nav-subsection-content.expanded { max-height: 1000px; }
        
        .nav-subsection-link {
            display: block;
            padding: 0.4rem 1rem 0.4rem 3.5rem;
            color: #006dcc;
            text-decoration: none;
            font-size: 13px;
            transition: background 0.15s;
        }
        
        .nav-subsection-link:hover {
            background: #e5e5e5;
            text-decoration: underline;
        }
        
        .nav-subsection-link.active {
            background: #1589ee;
            color: #fff;
            font-weight: 600;
        }
        
        .nav-subsection-link.active:hover {
            background: #0b5cab;
            text-decoration: none;
        }
        
        /* Main content */
        .main-content {
            width: calc(100% - 280px);
            margin-left: 280px;
            padding: 2rem 3rem;
            background: #fff;
            box-sizing: border-box;
        }

        
        
        .page-header{background:linear-gradient(135deg,#11998e 0%,#38ef7d 100%);color:#fff;padding:3rem;border-radius:12px;margin-bottom:3rem}
        .section-box{background:#fff;border:2px solid #e0e0e0;padding:2.5rem;margin:2rem 0;border-radius:12px}
        .section-box h3{color:#11998e;margin-top:0;border-bottom:2px solid #38ef7d;padding-bottom:0.5rem}
        table{width:100%;border-collapse:collapse;margin:1.5rem 0}
        th,td{border:1px solid #ddd;padding:12px;text-align:left}
        th{background:linear-gradient(135deg,#11998e 0%,#38ef7d 100%);color:#fff}
        .badge{display:inline-block;background:#667eea;color:#fff;padding:0.3rem 0.6rem;border-radius:12px;font-size:0.75rem;font-weight:600;margin:0.2rem}
        .badge-functional{background:#11998e}
        .badge-technical{background:#e74c3c}
    </style>
</head>
<body>
    <header>
        <div class="container header-container">
            <div class="nav-left">
                <a href="../index.html" class="logo"><div class="logo-box">RevNova</div></a>
            </div>
        </div>
    </header>

    <div class="requirements-layout">
                                        <aside class="sidebar">
            <nav class="sidebar-nav">
                <!-- Platform Vision Section -->
                <div class="nav-section">
                    <button class="nav-section-header">
                        <svg class="nav-section-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 6L14 10L6 14V6Z"/>
                        </svg>
                        Platform Vision
                    </button>
                    <div class="nav-section-content">
                        <a href="requirements-home.html" class="nav-link">RevNova Vision & Strategy</a>
                        <a href="business-requirements.html" class="nav-link">High Level Business Requirements</a>
                        <a href="high-level-functional.html" class="nav-link">High Level Functional Design</a>
                    </div>
                </div>
                
                <!-- Phase 1 Section -->
                <div class="nav-section">
                    <button class="nav-section-header expanded">
                        <svg class="nav-section-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 6L14 10L6 14V6Z"/>
                        </svg>
                        Phase 1 - SFDC CPQ â†’ RCA Migration (MVP)
                    </button>
                    <div class="nav-section-content expanded">
                        <!-- Functional Requirements Subsection -->
                        <div class="nav-subsection">
                            <button class="nav-subsection-header">
                                <svg class="nav-subsection-icon" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M6 6L14 10L6 14V6Z"/>
                                </svg>
                                Functional Requirements
                            </button>
                            <div class="nav-subsection-content">
                                <a href="requirements-phase1-connect.html" class="nav-subsection-link">1. Connection Wizard</a>
                                <a href="requirements-phase1-analyze.html" class="nav-subsection-link">2. Schema Analysis</a>
                                <a href="requirements-phase1-mapping.html" class="nav-subsection-link">3. Field Mapping</a>
                                <a href="requirements-phase1-transform.html" class="nav-subsection-link">4. Data Transformation</a>
                                <a href="requirements-phase1-validate.html" class="nav-subsection-link">5. Validation</a>
                                <a href="requirements-phase1-execute.html" class="nav-subsection-link">6. Migration Execution</a>
                                <a href="requirements-phase1-test.html" class="nav-subsection-link">7. Post-Migration Testing</a>
                                <a href="requirements-phase1-quotes.html" class="nav-subsection-link">8. Quotes</a>
                                <a href="requirements-phase1-contracts.html" class="nav-subsection-link">9. Contracts</a>
                                <a href="requirements-phase1-subscriptions.html" class="nav-subsection-link">10. Subscriptions</a>
                                <a href="requirements-phase1-inflight.html" class="nav-subsection-link">11. In-Flight Orders</a>
                            </div>
                        </div>
                        
                        <!-- Technical Requirements Subsection -->
                        <div class="nav-subsection">
                            <button class="nav-subsection-header">
                                <svg class="nav-subsection-icon" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M6 6L14 10L6 14V6Z"/>
                                </svg>
                                Technical Requirements
                            </button>
                            <div class="nav-subsection-content">
                                <a href="requirements-phase1-technical.html" class="nav-subsection-link">Migration Architecture</a>
                                <a href="requirements-phase1-technical.html#api" class="nav-subsection-link">API Specifications</a>
                                <a href="requirements-phase1-technical.html#database" class="nav-subsection-link">Database Schema</a>
                                <a href="requirements-phase1-technical.html#orchestration" class="nav-subsection-link">Orchestration Engine</a>
                            </div>
                        </div>
                        
                        <a href="requirements-mapping.html" class="nav-link">Complete Field Mapping</a>
                    </div>
                </div>
                
                <!-- Phase 2 Section -->
                <div class="nav-section">
                    <button class="nav-section-header">
                        <svg class="nav-section-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 6L14 10L6 14V6Z"/>
                        </svg>
                        Phase 2 - AI-Powered Configuration
                    </button>
                    <div class="nav-section-content">
                        <a href="requirements-phase2-functional.html" class="nav-link">Functional Requirements</a>
                        <a href="requirements-phase2-technical.html" class="nav-link">Technical Requirements</a>
                        <a href="ai-product-configuration.html" class="nav-link">AI Product Configuration Engine</a>
                    </div>
                </div>
                
                <!-- Phase 3 Section -->
                <div class="nav-section">
                    <button class="nav-section-header">
                        <svg class="nav-section-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 6L14 10L6 14V6Z"/>
                        </svg>
                        Phase 3 - Multi-CPQ Support
                    </button>
                    <div class="nav-section-content">
                        <a href="requirements-phase3-functional.html" class="nav-link">Functional Requirements</a>
                        <a href="requirements-phase3-technical.html" class="nav-link">Technical Requirements</a>
                    </div>
                </div>
                
                <!-- Phase 4 Section -->
                <div class="nav-section">
                    <button class="nav-section-header">
                        <svg class="nav-section-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 6L14 10L6 14V6Z"/>
                        </svg>
                        Phase 4 - CRM Integration
                    </button>
                    <div class="nav-section-content">
                        <a href="requirements-phase4-functional.html" class="nav-link">Functional Requirements</a>
                        <a href="requirements-phase4-technical.html" class="nav-link">Technical Requirements</a>
                    </div>
                </div>
                
                <!-- Phase 5 Section -->
                <div class="nav-section">
                    <button class="nav-section-header">
                        <svg class="nav-section-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 6L14 10L6 14V6Z"/>
                        </svg>
                        Phase 5 - ERP Connector
                    </button>
                    <div class="nav-section-content">
                        <a href="requirements-phase5-functional.html" class="nav-link">Functional Requirements</a>
                        <a href="requirements-phase5-technical.html" class="nav-link">Technical Requirements</a>
                    </div>
                </div>
                
                <!-- Additional Resources -->
                <div class="nav-section">
                    <button class="nav-section-header">
                        <svg class="nav-section-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 6L14 10L6 14V6Z"/>
                        </svg>
                        Additional Resources
                    </button>
                    <div class="nav-section-content">
                        <a href="security-compliance.html" class="nav-link">Security & Compliance</a>
                        <a href="performance-scalability.html" class="nav-link">Performance & Scalability</a>
                    </div>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <div class="page-header">
                <h1>ðŸ”„ Subscription Migration - Final Phase 1 Step</h1>
                <p>Migrate recurring subscription models to Revenue Cloud for automated billing and revenue recognition</p>
            </div>

            <section class="section-box">
                <h3><span class="badge badge-functional">Functional</span> Overview</h3>
                <p><strong>Purpose:</strong> Migrate active subscription models from CPQ to Revenue Cloud to enable automated recurring billing, usage-based pricing, and subscription lifecycle management (amendments, upgrades, cancellations).</p>
                
                <p><strong>Scope:</strong></p>
                <ul>
                    <li><strong>Active Subscriptions:</strong> Currently billing customers (monthly/annual/custom)</li>
                    <li><strong>Pending Changes:</strong> Subscription amendments awaiting next billing cycle</li>
                    <li><strong>Recurring Revenue:</strong> MRR/ARR tracking and forecasting</li>
                    <li><strong>Cancelled Subscriptions:</strong> Historical data for churn analysis</li>
                </ul>

                <p><strong>Business Impact:</strong></p>
                <ul>
                    <li>Enables automated recurring invoice generation</li>
                    <li>Supports usage-based pricing models (metered billing)</li>
                    <li>Maintains subscription revenue recognition schedules</li>
                    <li>Preserves customer subscription history and entitlements</li>
                    <li><strong>COMPLETES Phase 1 MVP migration</strong></li>
                </ul>
            </section>

            <section class="section-box">
                <h3><span class="badge badge-functional">Functional</span> Subscription Detection & Categorization</h3>
                
                <h4>BR-SB-001: Subscription Status Detection</h4>
                <table>
                    <tr><th>ID</th><th>Requirement</th><th>Priority</th></tr>
                    <tr><td>BR-SB-001.1</td><td>System SHALL categorize subscriptions: Active, Pending Changes, Recurring Revenue, Cancelled</td><td>P0</td></tr>
                    <tr><td>BR-SB-001.2</td><td>System SHALL display subscription counts in each category</td><td>P0</td></tr>
                    <tr><td>BR-SB-001.3</td><td>System SHALL calculate total MRR (Monthly Recurring Revenue) and ARR (Annual)</td><td>P0</td></tr>
                </table>

                <h4>BR-SB-002: Subscription Product Migration</h4>
                <table>
                    <tr><th>ID</th><th>Requirement</th><th>Priority</th></tr>
                    <tr><td>BR-SB-002.1</td><td>System SHALL migrate subscription products with billing frequency (monthly/quarterly/annual)</td><td>P0</td></tr>
                    <tr><td>BR-SB-002.2</td><td>System SHALL preserve subscription pricing (per-unit, tiered, volume)</td><td>P0</td></tr>
                    <tr><td>BR-SB-002.3</td><td>System SHALL link subscriptions to migrated Product2 records</td><td>P0</td></tr>
                    <tr><td>BR-SB-002.4</td><td>System SHALL maintain subscription quantities and terms</td><td>P0</td></tr>
                </table>
            </section>

            <section class="section-box">
                <h3><span class="badge badge-functional">Functional</span> Billing & Payment Schedules</h3>
                
                <h4>BR-SB-003: Billing Schedule Migration</h4>
                <table>
                    <tr><th>ID</th><th>Requirement</th><th>Priority</th></tr>
                    <tr><td>BR-SB-003.1</td><td>System SHALL migrate billing schedules (next billing date, billing cycle)</td><td>P0</td></tr>
                    <tr><td>BR-SB-003.2</td><td>System SHALL preserve billing frequency settings</td><td>P0</td></tr>
                    <tr><td>BR-SB-003.3</td><td>System SHALL maintain payment method references</td><td>P1</td></tr>
                    <tr><td>BR-SB-003.4</td><td>System SHALL copy invoice preferences (auto-send, billing contact)</td><td>P1</td></tr>
                </table>

                <h4>BR-SB-004: Usage-Based Pricing</h4>
                <table>
                    <tr><th>ID</th><th>Requirement</th><th>Priority</th></tr>
                    <tr><td>BR-SB-004.1</td><td>System SHALL migrate usage-based pricing models (per-transaction, per-API-call, per-user)</td><td>P0</td></tr>
                    <tr><td>BR-SB-004.2</td><td>System SHALL preserve usage tracking settings and thresholds</td><td>P1</td></tr>
                    <tr><td>BR-SB-004.3</td><td>System SHALL maintain historical usage data for trending</td><td>P1</td></tr>
                </table>
            </section>

            <section class="section-box">
                <h3><span class="badge badge-functional">Functional</span> Contract & Amendment Linking</h3>
                
                <h4>BR-SB-005: Contract Linking</h4>
                <table>
                    <tr><th>ID</th><th>Requirement</th><th>Priority</th></tr>
                    <tr><td>BR-SB-005.1</td><td>System SHALL link subscriptions to migrated Asset/Contract records</td><td>P0</td></tr>
                    <tr><td>BR-SB-005.2</td><td>System SHALL maintain master subscription and child subscription relationships</td><td>P1</td></tr>
                    <tr><td>BR-SB-005.3</td><td>System SHALL preserve subscription-to-account linkages</td><td>P0</td></tr>
                </table>

                <h4>BR-SB-006: Renewal & Amendment Terms</h4>
                <table>
                    <tr><th>ID</th><th>Requirement</th><th>Priority</th></tr>
                    <tr><td>BR-SB-006.1</td><td>System SHALL migrate renewal terms (auto-renew flags, renewal dates)</td><td>P0</td></tr>
                    <tr><td>BR-SB-006.2</td><td>System SHALL preserve pending amendments (upgrades, downgrades, add-ons)</td><td>P0</td></tr>
                    <tr><td>BR-SB-006.3</td><td>System SHALL maintain amendment effective dates</td><td>P0</td></tr>
                    <tr><td>BR-SB-006.4</td><td>System SHALL preserve historical amendments for audit trail</td><td>P1</td></tr>
                </table>
            </section>

            <section class="section-box">
                <h3><span class="badge badge-technical">Technical</span> User Interface Requirements</h3>
                
                <h4>UI-SB-001: Subscriptions Page Layout</h4>
                <table>
                    <tr><th>Element</th><th>Specification</th></tr>
                    <tr><td>Page Title</td><td>"Subscription Migration - Final Step" with sync/refresh icon</td></tr>
                    <tr><td>Summary Grid</td><td>4-column layout: Active (green #2e844a), Pending Changes (orange #FE9339), Recurring Revenue (blue #11998e), Cancelled (red #e74c3c)</td></tr>
                    <tr><td>Column Content</td><td>Large count, status label, MRR/ARR value, icon</td></tr>
                    <tr><td>Migration Options</td><td>Checkbox list (6 items): Migrate subscription products, Preserve billing schedules, Link to contracts, Maintain renewal terms, Migrate usage-based pricing models, Preserve historical amendments</td></tr>
                    <tr><td>Warning Box</td><td>Orange background (#FED7AA) with border (#FE9339): "This is the final step of Phase 1 migration. After completion, your full CPQ data will be available in Revenue Cloud."</td></tr>
                    <tr><td>Navigation</td><td>"Back to Contracts" (secondary), "Start Subscription Migration" (primary green gradient) â†’ Final Report</td></tr>
                </table>
            </section>

            <section class="section-box">
                <h3><span class="badge badge-technical">Technical</span> API Specifications</h3>
                
                <h4>API-SB-001: Analyze Subscriptions</h4>
                <table>
                    <tr><th>Property</th><th>Value</th></tr>
                    <tr><td>Endpoint</td><td>POST /api/v1/migration/subscriptions/analyze</td></tr>
                    <tr><td>Request</td><td>{ migrationId: string, includeCancelled: boolean }</td></tr>
                    <tr><td>Response</td><td>{ activeCount, pendingChangesCount, recurringRevenueCount, cancelledCount, totalMRR: number, totalARR: number, subscriptions: Subscription[] }</td></tr>
                </table>

                <h4>API-SB-002: Migrate Subscriptions</h4>
                <table>
                    <tr><th>Property</th><th>Value</th></tr>
                    <tr><td>Endpoint</td><td>POST /api/v1/migration/subscriptions/execute</td></tr>
                    <tr><td>Request</td><td>{ migrationId: string, options: { migrateProducts, preserveBillingSchedules, linkContracts, maintainRenewalTerms, migrateUsageBasedPricing, preserveAmendments } }</td></tr>
                    <tr><td>Response</td><td>{ jobId: string, status: string, subscriptionsProcessed: number, phase1Complete: boolean }</td></tr>
                </table>

                <h4>API-SB-003: Generate Final Report</h4>
                <table>
                    <tr><th>Property</th><th>Value</th></tr>
                    <tr><td>Endpoint</td><td>GET /api/v1/migration/{migrationId}/final-report</td></tr>
                    <tr><td>Response</td><td>{ migrationId, completionDate, totalProducts, totalQuotes, totalOrders, totalContracts, totalSubscriptions, successRate, phase1Status: "COMPLETE" }</td></tr>
                </table>
            </section>

            <section class="section-box">
                <h3><span class="badge badge-technical">Technical</span> Database Schema</h3>
                
                <h4>Table: subscription_migrations</h4>
                <table>
                    <tr><th>Column</th><th>Type</th><th>Description</th></tr>
                    <tr><td>id</td><td>UUID</td><td>Primary key</td></tr>
                    <tr><td>migration_id</td><td>UUID</td><td>Foreign key to migrations</td></tr>
                    <tr><td>source_subscription_id</td><td>VARCHAR(18)</td><td>CPQ Subscription ID</td></tr>
                    <tr><td>target_subscription_id</td><td>VARCHAR(18)</td><td>Revenue Cloud Subscription ID</td></tr>
                    <tr><td>subscription_status</td><td>VARCHAR(50)</td><td>Active | PendingChanges | Cancelled</td></tr>
                    <tr><td>billing_frequency</td><td>VARCHAR(20)</td><td>Monthly | Quarterly | Annual</td></tr>
                    <tr><td>mrr_amount</td><td>DECIMAL(18,2)</td><td>Monthly Recurring Revenue</td></tr>
                    <tr><td>arr_amount</td><td>DECIMAL(18,2)</td><td>Annual Recurring Revenue</td></tr>
                    <tr><td>next_billing_date</td><td>DATE</td><td>Next scheduled billing</td></tr>
                    <tr><td>linked_contract_id</td><td>VARCHAR(18)</td><td>Associated contract/asset</td></tr>
                    <tr><td>migrated_at</td><td>TIMESTAMP</td><td>Migration timestamp</td></tr>
                </table>
            </section>

            <section class="section-box">
                <h3><span class="badge badge-functional">Functional</span> Phase 1 Completion</h3>
                <p><strong>Success Criteria:</strong></p>
                <ul>
                    <li>âœ… Core product catalog migrated (products, price books, pricing rules)</li>
                    <li>âœ… Inflight business data migrated (quotes, orders)</li>
                    <li>âœ… Contracts converted to Assets</li>
                    <li>âœ… Subscriptions migrated with billing schedules</li>
                    <li>âœ… All relationships preserved (account, product, pricing)</li>
                    <li>âœ… Zero data loss validation passed</li>
                </ul>

                <p><strong>Post-Migration Actions:</strong></p>
                <ol>
                    <li>Review Final Report with migration summary</li>
                    <li>Test Revenue Cloud functionality with migrated data</li>
                    <li>Schedule user training sessions</li>
                    <li>Plan production cutover date</li>
                    <li><em>Optional:</em> Enable Phase 2 (AI Product Configuration)</li>
                </ol>
            </section>
        </main>
    </div>
    <script src="../script.js"></script>
    <script>
        // Collapsible navigation functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Handle section headers - single click toggle
            const sectionHeaders = document.querySelectorAll('.nav-section-header');
            sectionHeaders.forEach(header => {
                const newHeader = header.cloneNode(true);
                header.parentNode.replaceChild(newHeader, header);
            });
            
            document.querySelectorAll('.nav-section-header').forEach(header => {
                header.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const content = this.nextElementSibling;
                    const isExpanded = this.classList.contains('expanded');
                    
                    if (isExpanded) {
                        this.classList.remove('expanded');
                        content.classList.remove('expanded');
                    } else {
                        this.classList.add('expanded');
                        content.classList.add('expanded');
                    }
                });
            });
            
            // Handle subsection headers - single click toggle
            const subsectionHeaders = document.querySelectorAll('.nav-subsection-header');
            subsectionHeaders.forEach(header => {
                const newHeader = header.cloneNode(true);
                header.parentNode.replaceChild(newHeader, header);
            });
            
            document.querySelectorAll('.nav-subsection-header').forEach(header => {
                header.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const content = this.nextElementSibling;
                    const isExpanded = this.classList.contains('expanded');
                    
                    if (isExpanded) {
                        this.classList.remove('expanded');
                        content.classList.remove('expanded');
                    } else {
                        this.classList.add('expanded');
                        content.classList.add('expanded');
                    }
                });
            });
            
            // Auto-expand section containing active link
            const activeLinks = document.querySelectorAll('.nav-link.active, .nav-subsection-link.active');
            activeLinks.forEach(link => {
                // Expand parent section
                let section = link.closest('.nav-section-content');
                if (section) {
                    section.classList.add('expanded');
                    section.previousElementSibling.classList.add('expanded');
                }
                
                // Expand parent subsection if exists
                let subsection = link.closest('.nav-subsection-content');
                if (subsection) {
                    subsection.classList.add('expanded');
                    subsection.previousElementSibling.classList.add('expanded');
                }
            });
        });
    </script>

    <script>
        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
            // Clone all section headers to remove any duplicate event listeners
            const sectionHeaders = document.querySelectorAll('.nav-section-header');
            sectionHeaders.forEach(header => {
                const newHeader = header.cloneNode(true);
                header.parentNode.replaceChild(newHeader, header);
            });
            
            // Clone all subsection headers
            const subsectionHeaders = document.querySelectorAll('.nav-subsection-header');
            subsectionHeaders.forEach(header => {
                const newHeader = header.cloneNode(true);
                header.parentNode.replaceChild(newHeader, header);
            });
            
            // Add click handlers to main section headers
            document.querySelectorAll('.nav-section-header').forEach(header => {
                header.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const content = this.nextElementSibling;
                    const isExpanded = this.classList.contains('expanded');
                    
                    if (isExpanded) {
                        this.classList.remove('expanded');
                        content.classList.remove('expanded');
                    } else {
                        this.classList.add('expanded');
                        content.classList.add('expanded');
                    }
                });
            });
            
            // Add click handlers to subsection headers
            document.querySelectorAll('.nav-subsection-header').forEach(header => {
                header.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const content = this.nextElementSibling;
                    const isExpanded = this.classList.contains('expanded');
                    
                    if (isExpanded) {
                        this.classList.remove('expanded');
                        content.classList.remove('expanded');
                    } else {
                        this.classList.add('expanded');
                        content.classList.add('expanded');
                    }
                });
            });
            
            // Auto-expand section containing active link
            const activeLink = document.querySelector('.nav-link.active, .nav-subsection-link.active');
            if (activeLink) {
                let parent = activeLink.parentElement;
                while (parent && !parent.classList.contains('sidebar')) {
                    if (parent.classList.contains('nav-section-content') || parent.classList.contains('nav-subsection-content')) {
                        parent.classList.add('expanded');
                        const header = parent.previousElementSibling;
                        if (header) {
                            header.classList.add('expanded');
                        }
                    }
                    parent = parent.parentElement;
                }
            }
        });
    </script>
</body>
</html>
