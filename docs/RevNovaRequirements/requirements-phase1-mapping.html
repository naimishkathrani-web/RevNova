<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Phase 1 - Field Mapping | RevNova Requirements</title>
    <link rel="stylesheet" href="../styles.css">
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; }
        .requirements-layout{display:flex;min-height:calc(100vh - 80px);margin-top:80px}
        .sidebar{width:280px;background:#f8f9fa;border-right:1px solid #e0e0e0;padding:2rem 0;position:fixed;left:0;top:80px;height:calc(100vh - 80px);overflow-y:auto;z-index:100}
        .sidebar h3{padding:0 1.5rem;font-size:0.85rem;color:#666;text-transform:uppercase;letter-spacing:0.5px;margin:1.5rem 0 0.5rem}
        .sidebar ul{list-style:none;padding:0;margin:0}
        .sidebar ul li a{display:block;padding:0.6rem 1.5rem;color:#333;text-decoration:none;font-size:0.95rem;transition:all 0.2s}
        .sidebar ul li a:hover{background:#e9ecef;color:#11998e}
        .sidebar ul li a.active{background:#11998e;color:#fff;font-weight:500}
        .sidebar ul ul li a{padding-left:2.5rem;font-size:0.9rem}
        .main-content{flex:1;margin-left:280px;padding:3rem;background:#fff;min-width:0}
        .page-header{background:linear-gradient(135deg,#11998e 0%,#38ef7d 100%);color:#fff;padding:3rem;border-radius:12px;margin-bottom:3rem;box-shadow:0 4px 15px rgba(17,153,142,0.2)}
        .page-header h1{margin:0 0 1rem 0;font-size:2.5rem;font-weight:700}
        .section-box{background:#fff;border:2px solid #e0e0e0;padding:2.5rem;margin:2rem 0;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.05)}
        .section-box h3{color:#11998e;margin-top:0;border-bottom:2px solid #38ef7d;padding-bottom:0.5rem}
        table{width:100%;border-collapse:collapse;margin:1.5rem 0;background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.05)}
        th,td{border:1px solid #ddd;padding:12px;text-align:left}
        th{background:linear-gradient(135deg,#11998e 0%,#38ef7d 100%);color:#fff;font-weight:600;text-transform:uppercase;font-size:0.85rem}
        tr:hover{background:#f8f9fa}
        .wireframe{background:#f8f9fa;border:2px dashed #11998e;padding:2rem;margin:1.5rem 0;border-radius:8px;font-family:monospace;font-size:0.85rem}
        .badge{display:inline-block;background:#667eea;color:#fff;padding:0.3rem 0.6rem;border-radius:12px;font-size:0.75rem;font-weight:600;margin:0.2rem}
        .badge-functional{background:#11998e}
        .badge-technical{background:#e74c3c}
    </style>
</head>
<body>
    <header>
        <div class="container header-container">
            <div class="nav-left">
                <a href="../index.html" class="logo"><div class="logo-box">RevNova</div></a>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../about-revnova.html">About RevNova</a></li>
                        <li><a href="../features.html">Features</a></li>
                        <li><a href="../pricing.html">Pricing</a></li>
                        <li><a href="requirements-home.html" class="active">RevNova Requirements</a></li>
                        <li><a href="../contact.html">Contact</a></li>
                    </ul>
                </nav>
            </div>
            <div class="header-right">
                <div class="country-selector"><span class="fi fi-us"></span></div>
                <a href="../login.html" class="btn btn-login">Login</a>
            </div>
        </div>
    </header>

    <div class="requirements-layout">
        <aside class="sidebar">
            <h3>Platform Vision</h3>
            <ul>
                <li><a href="requirements-home.html">RevNova Vision & Strategy</a></li>
                <li><a href="business-requirements.html">High Level Business Requirements</a></li>
                <li><a href="high-level-functional.html">High Level Functional Design</a></li>
            </ul>
            <h3>Phase 1 - Migration Wizard</h3>
            <ul>
                <li><a href="requirements-phase1-connect.html">1. Connection Wizard</a></li>
                <li><a href="requirements-phase1-analyze.html">2. Schema Analysis</a></li>
                <li><a href="requirements-phase1-mapping.html" class="active">3. Field Mapping</a></li>
                <li><a href="requirements-phase1-transform.html">4. Data Transformation</a></li>
                <li><a href="requirements-phase1-validate.html">5. Validation</a></li>
                <li><a href="requirements-phase1-execute.html">6. Migration Execution</a></li>
                <li><a href="requirements-phase1-test.html">7. Post-Migration Testing</a></li>
                <li><a href="requirements-phase1-technical.html">Technical Architecture</a></li>
                <li><a href="requirements-mapping.html">Complete Field Mapping</a></li>
            </ul>
        </aside>

        <main class="main-content">
            <div class="page-header">
                <h1>🗺️ Page 3: Field Mapping Editor</h1>
                <p>AI-powered field mapping with drag-drop interface, confidence scoring, and value mapping capabilities</p>
            </div>

            <section class="section-box">
                <h3><span class="badge badge-functional">Functional</span> Overview</h3>
                <p><strong>Purpose:</strong> Map source fields to target fields using AI-powered suggestions (≥85% accuracy) combined with intuitive drag-drop manual mapping interface.</p>
                <p><strong>User Journey:</strong></p>
                <ol style="line-height:1.8">
                    <li>User lands on Field Mapping page with pre-loaded schema from Step 2</li>
                    <li>AI automatically suggests field mappings with confidence scores</li>
                    <li>User reviews AI suggestions (green checkmarks for high confidence ≥85%)</li>
                    <li>User accepts bulk AI mappings or reviews individually</li>
                    <li>User drag-drops unmapped fields to create manual mappings</li>
                    <li>User configures value mappings for picklists and lookup fields</li>
                    <li>User saves mapping template for reuse</li>
                    <li>User clicks "Next" to proceed to Transformation Rules</li>
                </ol>
            </section>

            <section class="section-box">
                <h3><span class="badge badge-functional">Functional</span> UI Wireframe</h3>
                <div class="wireframe">
                    <pre>
┌────────────────────────────────────────────────────────────────┐
│  RevNova Migration Wizard                    Step 3 of 7       │
├────────────────────────────────────────────────────────────────┤
│  🗺️ Field Mapping Editor - Product2 Object (24 fields)        │
│                                                                  │
│  AI Mapping: 20/24 auto-mapped (83%) | [Accept All AI] [Review]│
│                                                                  │
│  ┌──────────────────────┬────────┬──────────────────────────┐  │
│  │ SOURCE FIELDS        │        │ TARGET FIELDS            │  │
│  ├──────────────────────┼────────┼──────────────────────────┤  │
│  │ ☑ Name (Text 80)     │ →→→→→→ │ ☑ Name (Text 255)       │  │
│  │   Confidence: 98% ✅ │        │   Match: Exact           │  │
│  │                      │        │                          │  │
│  │ ☑ ProductCode        │ →→→→→→ │ ☑ ProductCode            │  │
│  │   (Text 255)         │        │   (Text 255)             │  │
│  │   Confidence: 100% ✅│        │   Match: Exact           │  │
│  │                      │        │                          │  │
│  │ ☐ Custom_Price__c    │   ⚠️   │ ☐ ListPrice              │  │
│  │   (Currency)         │ ┈┈┈┈┈┈→│   (Currency)             │  │
│  │   Confidence: 72% ⚠️ │        │   Match: Suggested       │  │
│  │   [Review] [Accept]  │        │                          │  │
│  │                      │        │                          │  │
│  │ □ Legacy_ID__c       │        │ □ (drag here)            │  │
│  │   (Text 18)          │  [?]   │                          │  │
│  │   NO MATCH FOUND     │        │   [+ Add Mapping]        │  │
│  │                      │        │                          │  │
│  │ ☑ IsActive (Bool)    │ →→→→→→ │ ☑ IsActive (Bool)        │  │
│  │   Confidence: 100% ✅│        │   Match: Exact           │  │
│  └──────────────────────┴────────┴──────────────────────────┘  │
│                                                                  │
│  VALUE MAPPING (for Legacy_ID__c → ExternalId):                 │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │ Source Pattern: PROD-[0-9]{6}  → Target: [ExternalId__c]  │ │
│  │ Transform: Remove "PROD-" prefix, keep numeric portion     │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  [Save Template] [Load Template]  [< Back]         [Next >]    │
└────────────────────────────────────────────────────────────────┘
                    </pre>
                </div>
            </section>

            <section class="section-box">
                <h3><span class="badge badge-functional">Functional</span> Detailed Requirements</h3>
                <h4>FR-MAP-001: AI-Powered Field Mapping</h4>
                <table>
                    <tr><th>Requirement ID</th><th>Description</th><th>Acceptance Criteria</th></tr>
                    <tr><td>FR-MAP-001.1</td><td>System shall auto-suggest field mappings using ML model</td><td>AI model trained on 10,000+ field mappings, ≥85% accuracy on standard fields</td></tr>
                    <tr><td>FR-MAP-001.2</td><td>System shall display confidence score for each suggestion</td><td>Score 0-100%, visual indicators: ✅ ≥85% (green), ⚠️ 70-84% (yellow), ❌ &lt;70% (red)</td></tr>
                    <tr><td>FR-MAP-001.3</td><td>System shall prioritize exact name matches</td><td>Exact matches (Name→Name) get 100% confidence, display "Match: Exact" label</td></tr>
                    <tr><td>FR-MAP-001.4</td><td>System shall suggest compatible type mappings</td><td>Text→LongTextArea, Number→Currency, Date→DateTime mappings with 90%+ confidence</td></tr>
                </table>

                <h4>FR-MAP-002: Manual Mapping Interface</h4>
                <table>
                    <tr><th>Requirement ID</th><th>Description</th><th>Acceptance Criteria</th></tr>
                    <tr><td>FR-MAP-002.1</td><td>System shall support drag-drop field mapping</td><td>User drags source field, drops on target field, connection line animates</td></tr>
                    <tr><td>FR-MAP-002.2</td><td>System shall validate type compatibility on drop</td><td>Incompatible types show error modal: "Cannot map Text to Boolean"</td></tr>
                    <tr><td>FR-MAP-002.3</td><td>System shall allow unmapping fields</td><td>Click "X" icon on mapping to remove, field returns to unmapped state</td></tr>
                    <tr><td>FR-MAP-002.4</td><td>System shall highlight unmapped fields</td><td>Unmapped fields have red border, counter shows "4 unmapped fields remaining"</td></tr>
                </table>

                <h4>FR-MAP-003: Value Mapping for Picklists & Lookups</h4>
                <table>
                    <tr><th>Requirement ID</th><th>Description</th><th>Acceptance Criteria</th></tr>
                    <tr><td>FR-MAP-003.1</td><td>System shall detect picklist value mismatches</td><td>Source "Draft,Approved,Rejected" vs Target "New,Approved,Cancelled" triggers value mapping UI</td></tr>
                    <tr><td>FR-MAP-003.2</td><td>System shall provide picklist value mapping interface</td><td>Table: Source Value → Target Value with dropdowns, "Not Mapped" option</td></tr>
                    <tr><td>FR-MAP-003.3</td><td>System shall support default value for unmapped picklist values</td><td>User sets default: "Map all unmapped to 'Other'", applied during migration</td></tr>
                    <tr><td>FR-MAP-003.4</td><td>System shall detect lookup relationships</td><td>Lookup fields flagged with 🔗 icon, user selects ID mapping strategy (external ID, formula, etc.)</td></tr>
                </table>

                <h4>FR-MAP-004: Mapping Templates</h4>
                <table>
                    <tr><th>Requirement ID</th><th>Description</th><th>Acceptance Criteria</th></tr>
                    <tr><td>FR-MAP-004.1</td><td>System shall allow saving mapping templates</td><td>"Save Template" button, user enters template name, saved to user profile</td></tr>
                    <tr><td>FR-MAP-004.2</td><td>System shall allow loading saved templates</td><td>"Load Template" dropdown lists saved templates, click to apply mappings</td></tr>
                    <tr><td>FR-MAP-004.3</td><td>System shall support template sharing</td><td>Checkbox "Share with team", template visible to all org users</td></tr>
                </table>
            </section>

            <section class="section-box">
                <h3><span class="badge badge-technical">Technical</span> AI Mapping Model</h3>
                <pre style="background:#2d2d2d;color:#f8f8f2;padding:1rem;border-radius:8px;overflow-x:auto">
// AI Field Mapping Algorithm
class FieldMappingAI {
  predictMapping(sourceField, targetFields) {
    const candidates = targetFields.map(targetField => ({
      target: targetField,
      score: this.calculateSimilarity(sourceField, targetField)
    }));
    
    return candidates
      .filter(c => c.score >= 0.70) // Minimum 70% confidence
      .sort((a, b) => b.score - a.score)[0]; // Return highest score
  }
  
  calculateSimilarity(source, target) {
    let score = 0;
    
    // Exact name match = 100%
    if (source.name === target.name) return 1.0;
    
    // Semantic similarity using embeddings (GPT-4 embeddings API)
    const semanticScore = this.cosineSimilarity(
      this.getEmbedding(source.name),
      this.getEmbedding(target.name)
    );
    score += semanticScore * 0.6; // 60% weight
    
    // Type compatibility
    if (source.type === target.type) score += 0.3; // 30% weight
    else if (this.isCompatibleType(source.type, target.type)) score += 0.15;
    
    // Length compatibility (for string fields)
    if (source.length && target.length >= source.length) score += 0.1; // 10% weight
    
    return Math.min(score, 1.0);
  }
}
                </pre>

                <h4>TA-MAP-001: Database Schema for Mappings</h4>
                <pre style="background:#2d2d2d;color:#f8f8f2;padding:1rem;border-radius:8px;overflow-x:auto">
CREATE TABLE field_mappings (
    mapping_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    migration_id UUID NOT NULL REFERENCES migrations(migration_id),
    source_object VARCHAR(255) NOT NULL,
    target_object VARCHAR(255) NOT NULL,
    source_field VARCHAR(255) NOT NULL,
    target_field VARCHAR(255) NOT NULL,
    mapping_type VARCHAR(20) NOT NULL CHECK (mapping_type IN ('direct', 'transform', 'formula', 'lookup')),
    confidence_score DECIMAL(5,2), -- AI confidence 0.00-1.00
    is_ai_suggested BOOLEAN DEFAULT false,
    is_user_approved BOOLEAN DEFAULT false,
    value_mappings JSONB, -- For picklist value mappings
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(migration_id, source_object, source_field)
);

CREATE TABLE mapping_templates (
    template_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(user_id),
    template_name VARCHAR(255) NOT NULL,
    is_shared BOOLEAN DEFAULT false,
    mappings JSONB NOT NULL, -- Array of mapping objects
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
                </pre>
            </section>

            <section>
                <h2>Navigation</h2>
                <ul style="line-height:2">
                    <li><strong>Previous:</strong> <a href="requirements-phase1-analyze.html">Page 2: Schema Analysis</a></li>
                    <li><strong>Next:</strong> <a href="requirements-phase1-transform.html">Page 4: Data Transformation</a></li>
                </ul>
            </section>
        </main>
    </div>
</body>
</html>
