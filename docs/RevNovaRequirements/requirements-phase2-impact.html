<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Phase 2 - System Impact Analyzer | RevNova Requirements</title>
    <link rel="stylesheet" href="../styles.css">
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; }
        .requirements-layout{display:flex;min-height:calc(100vh - 80px);margin-top:80px}
        .sidebar{width:280px;background:#f8f9fa;border-right:1px solid #e0e0e0;padding:2rem 0;position:fixed;left:0;top:80px;height:calc(100vh - 80px);overflow-y:auto;z-index:100}
        .sidebar h3{padding:0 1.5rem;font-size:0.85rem;color:#666;text-transform:uppercase;letter-spacing:0.5px;margin:1.5rem 0 0.5rem}
        .sidebar ul{list-style:none;padding:0;margin:0}
        .sidebar ul li a{display:block;padding:0.6rem 1.5rem;color:#333;text-decoration:none;font-size:0.95rem;transition:all 0.2s}
        .sidebar ul li a:hover{background:#e9ecef;color:#11998e}
        .sidebar ul li a.active{background:#11998e;color:#fff;font-weight:500}
        .sidebar ul ul li a{padding-left:2.5rem;font-size:0.9rem}
        .main-content{flex:1;margin-left:280px;padding:3rem;background:#fff;min-width:0}
        .page-header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:3rem;border-radius:12px;margin-bottom:3rem}
        .section-box{background:#fff;border:2px solid #e0e0e0;padding:2.5rem;margin:2rem 0;border-radius:12px}
        .section-box h3{color:#667eea;margin-top:0;border-bottom:2px solid #764ba2;padding-bottom:0.5rem}
        table{width:100%;border-collapse:collapse;margin:1.5rem 0}
        th,td{border:1px solid #ddd;padding:12px;text-align:left}
        th{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;font-weight:600;font-size:0.85rem}
        .badge-functional{background:#3498db;color:#fff;padding:0.3rem 0.6rem;border-radius:12px;font-size:0.75rem;font-weight:600}
        .badge-technical{background:#e74c3c;color:#fff;padding:0.3rem 0.6rem;border-radius:12px;font-size:0.75rem;font-weight:600}
        .ui-wireframe{background:#f9f9f9;border:2px dashed #ccc;padding:1.5rem;margin:1rem 0;border-radius:8px;font-family:monospace;font-size:0.85rem;line-height:1.6}
    </style>
</head>
<body>
    <header>
        <div class="container header-container">
            <div class="nav-left">
                <a href="../index.html" class="logo"><div class="logo-box">RevNova</div></a>
                <nav class="main-nav">
                    <ul>
                        <li><a href="../about-revnova.html">About RevNova</a></li>
                        <li><a href="../features.html">Features</a></li>
                        <li><a href="../pricing.html">Pricing</a></li>
                        <li><a href="requirements-home.html" class="active">RevNova Requirements</a></li>
                        <li><a href="../contact.html">Contact</a></li>
                    </ul>
                </nav>
            </div>
            <div class="header-right">
                <div class="country-selector"><span class="fi fi-us"></span></div>
                <a href="../login.html" class="btn btn-login">Login</a>
            </div>
        </div>
    </header>

    <div class="requirements-layout">
        <aside class="sidebar">
            <h3>Platform Vision</h3>
            <ul>
                <li><a href="requirements-home.html">RevNova Vision & Strategy</a></li>
                <li><a href="business-requirements.html">High Level Business Requirements</a></li>
                <li><a href="high-level-functional.html">High Level Functional Design</a></li>
            </ul>
            <h3>Phase 2 - AI Product Platform</h3>
            <ul>
                <li><a href="requirements-phase2-generate.html">1. Generate with AI</a></li>
                <li><a href="requirements-phase2-modify.html">2. Modify with AI</a></li>
                <li><a href="requirements-phase2-adopt.html">3. Adopt AI Suggestions</a></li>
                <li><a href="requirements-phase2-planning.html">4. Planning Tools</a></li>
                <li><a href="requirements-phase2-impact.html" class="active">5. System Impact Analyzer</a></li>
                <li><a href="requirements-phase2-budget.html">6. Budget Calculator</a></li>
                <li><a href="requirements-phase2-technical.html">Technical Architecture</a></li>
            </ul>
        </aside>

        <main class="main-content">
            <div class="page-header">
                <h1>🔍 System Impact Analyzer - Dependency & Risk Assessment</h1>
                <p>Analyze downstream impacts of product configuration changes across the enterprise</p>
            </div>

            <div class="ui-wireframe">
┌────────────────────────────────────────────────────────────────┐
│  System Impact Analysis                               [Help] [?]│
├────────────────────────────────────────────────────────────────┤
│  Product: Professional Services Package                        │
│  Change: Adding monthly retainer SKU + custom fields           │
│                                                                 │
│  🎯 Impact Summary:                                            │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 🔴 High Risk:   2 systems  (CRM Integration, Quote Templates)│
│  │ ⚠️ Medium Risk: 3 systems  (Billing, Reports, Workflows)    │
│  │ ✅ Low Risk:    1 system   (Marketing Automation)           │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ▼ Affected Systems (6 of 12 total integrations):             │
│                                                                 │
│  🔴 HIGH RISK: CRM Integration (Salesforce ↔ HubSpot)          │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ • API Contract Change: New field "Included_Hours__c"      │  │
│  │   requires HubSpot custom property mapping               │  │
│  │ • Sync Impact: 15,000 active deals need field update     │  │
│  │ • Data Model Impact: HubSpot schema update required      │  │
│  │ • Recommended Action: Test on sandbox, notify CRM admin  │  │
│  │ • Estimated Effort: 8 hours (4h dev + 4h testing)        │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│  🔴 HIGH RISK: Quote Templates (CPQ → DocuSign)                │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ • Template Update: 12 active quote templates need        │  │
│  │   "Monthly Retainer" SKU added to picklist               │  │
│  │ • Broken Templates: 3 templates use hardcoded SKU list   │  │
│  │ • DocuSign Impact: Contract template needs new clause    │  │
│  │ • Recommended Action: Update templates, re-approve legal │  │
│  │ • Estimated Effort: 12 hours (template redesign)         │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ⚠️ MEDIUM RISK: Billing System (Salesforce → Stripe)          │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ • New Subscription Plan: Create "Monthly Retainer" plan  │  │
│  │   in Stripe with $500 price point                        │  │
│  │ • Webhook Update: Add "included_hours" to invoice line   │  │
│  │ • Migration Impact: None (new SKU only, no existing)     │  │
│  │ • Estimated Effort: 4 hours (Stripe config + testing)    │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│       [📊 Generate Full Report]   [📧 Notify Stakeholders]     │
└────────────────────────────────────────────────────────────────┘
            </div>

            <section class="section-box">
                <h3><span class="badge-functional">Functional</span> Dependency Mapping</h3>
                <table>
                    <tr><th>Requirement ID</th><th>Description</th><th>Acceptance Criteria</th></tr>
                    <tr>
                        <td><strong>FR-IMPACT-001.1</strong></td>
                        <td>Integration Inventory</td>
                        <td>• Auto-discover connected systems (Salesforce metadata API scan)<br>• Categorize: CRM, Billing, ERP, Marketing, Analytics, Reporting<br>• Track integration type: REST API, Webhook, Middleware (MuleSoft, Zapier), File Transfer<br>• Display last sync timestamp and health status</td>
                    </tr>
                    <tr>
                        <td><strong>FR-IMPACT-001.2</strong></td>
                        <td>Field-Level Dependency Graph</td>
                        <td>• Show which downstream systems consume each product field<br>• Visualize dependency graph (D3.js force-directed graph)<br>• Click field → highlight all dependent systems<br>• Export graph as PNG or SVG</td>
                    </tr>
                    <tr>
                        <td><strong>FR-IMPACT-001.3</strong></td>
                        <td>API Contract Analysis</td>
                        <td>• Detect API schema changes (new fields, renamed fields, removed fields)<br>• Compare current API contract vs proposed changes (JSON diff)<br>• Flag breaking changes (removed fields, type changes)<br>• Suggest versioning strategy (v1 → v2 with deprecation period)</td>
                    </tr>
                </table>
            </section>

            <section class="section-box">
                <h3><span class="badge-functional">Functional</span> Risk Scoring & Prioritization</h3>
                <table>
                    <tr><th>Risk Level</th><th>Criteria</th><th>Example</th></tr>
                    <tr>
                        <td><strong>🔴 High Risk</strong></td>
                        <td>• Breaking API changes<br>• >10,000 records affected<br>• Mission-critical system (billing, orders)</td>
                        <td>Removing a field used by billing system → payment failures</td>
                    </tr>
                    <tr>
                        <td><strong>⚠️ Medium Risk</strong></td>
                        <td>• New fields (non-breaking)<br>• 1,000-10,000 records affected<br>• Important but not critical (reporting, marketing)</td>
                        <td>Adding custom field → update 5,000 existing records to populate</td>
                    </tr>
                    <tr>
                        <td><strong>✅ Low Risk</strong></td>
                        <td>• Cosmetic changes<br>• <1,000 records affected<br>• Optional systems (analytics, demos)</td>
                        <td>Renaming product description → no downstream impact</td>
                    </tr>
                </table>
            </section>

            <section class="section-box">
                <h3><span class="badge-functional">Functional</span> Impact Report Generation</h3>
                <table>
                    <tr><th>Report Section</th><th>Content</th></tr>
                    <tr><td><strong>Executive Summary</strong></td><td>Risk score (0-100), # systems affected, total effort estimate (hours)</td></tr>
                    <tr><td><strong>System-by-System Breakdown</strong></td><td>For each system: risk level, specific changes needed, data migration plan, testing checklist</td></tr>
                    <tr><td><strong>Timeline & Dependencies</strong></td><td>Critical path diagram (e.g., "Must update CRM before billing"), suggested rollout sequence</td></tr>
                    <tr><td><strong>Stakeholder Action Items</strong></td><td>Auto-assign tasks (e.g., "CRM Admin: Update HubSpot schema by EOW")</td></tr>
                    <tr><td><strong>Rollback Plan</strong></td><td>If change causes issues, steps to revert (restore from backup, API rollback)</td></tr>
                </table>
            </section>

            <section class="section-box">
                <h3><span class="badge-technical">Technical</span> Impact Analysis Algorithm</h3>
                <pre style="background:#2d2d2d;color:#f8f8f2;padding:1rem;border-radius:8px;overflow-x:auto">
// Analyze downstream impact of product change
async function analyzeImpact(change: ProductChange): Promise<ImpactReport> {
    const impacts: SystemImpact[] = [];
    
    // Step 1: Identify affected fields
    const affectedFields = extractAffectedFields(change);
    
    // Step 2: Query integration metadata (Salesforce Connected Apps + custom integrations)
    const integrations = await getActiveIntegrations();
    
    // Step 3: For each integration, check if it uses affected fields
    for (const integration of integrations) {
        const usedFields = await getFieldUsage(integration.id);
        const overlap = affectedFields.filter(f => usedFields.includes(f));
        
        if (overlap.length > 0) {
            // Calculate risk score
            const riskScore = calculateRiskScore({
                isBreakingChange: change.type === 'DELETE' || change.type === 'RENAME',
                recordsAffected: await getRecordCount(overlap),
                systemCriticality: integration.criticality, // 'high', 'medium', 'low'
                integrationHealth: integration.lastSyncStatus // healthy vs failing
            });
            
            impacts.push({
                system: integration.name,
                riskLevel: riskScore >= 7 ? 'HIGH' : riskScore >= 4 ? 'MEDIUM' : 'LOW',
                affectedFields: overlap,
                estimatedEffort: estimateEffortHours(riskScore, overlap.length),
                recommendedActions: generateRecommendations(integration, overlap)
            });
        }
    }
    
    return { impacts, totalRiskScore: calculateTotalRisk(impacts) };
}

// Risk scoring formula
function calculateRiskScore(factors: RiskFactors): number {
    let score = 0;
    if (factors.isBreakingChange) score += 5;
    if (factors.recordsAffected > 10000) score += 3;
    else if (factors.recordsAffected > 1000) score += 2;
    if (factors.systemCriticality === 'high') score += 4;
    else if (factors.systemCriticality === 'medium') score += 2;
    if (factors.integrationHealth === 'failing') score += 1;
    return Math.min(score, 10); // Max score = 10
}
                </pre>
            </section>

            <section class="section-box">
                <h3><span class="badge-technical">Technical</span> Database Schema - Integration Registry</h3>
                <pre style="background:#2d2d2d;color:#f8f8f2;padding:1rem;border-radius:8px;overflow-x:auto">
CREATE TABLE integrations (
    integration_id UUID PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    category VARCHAR(100), -- 'CRM', 'Billing', 'ERP', etc.
    integration_type VARCHAR(100), -- 'REST_API', 'WEBHOOK', 'MIDDLEWARE'
    criticality VARCHAR(50), -- 'high', 'medium', 'low'
    field_mappings JSONB, -- { "salesforce_field": "external_field" }
    last_sync_at TIMESTAMP,
    health_status VARCHAR(50) -- 'healthy', 'degraded', 'failing'
);

CREATE TABLE impact_analyses (
    analysis_id UUID PRIMARY KEY,
    product_id UUID NOT NULL,
    change_description TEXT NOT NULL,
    impacts JSONB NOT NULL, -- Array of SystemImpact objects
    total_risk_score INTEGER,
    report_url VARCHAR(500), -- S3 URL for PDF report
    created_at TIMESTAMP DEFAULT NOW()
);
                </pre>
            </section>

            <section>
                <h2>Navigation</h2>
                <ul style="line-height:2">
                    <li><strong>Previous:</strong> <a href="requirements-phase2-planning.html">Page 4: Planning Tools</a></li>
                    <li><strong>Next:</strong> <a href="requirements-phase2-budget.html">Page 6: Budget Calculator</a></li>
                </ul>
            </section>
        </main>
    </div>
</body>
</html>
