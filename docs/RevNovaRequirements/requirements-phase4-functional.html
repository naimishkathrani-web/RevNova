<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Phase 4 — Functional Requirements</title>
  <link rel="stylesheet" href="../styles.css">
  <style>
    .field-table{width:100%;border-collapse:collapse;margin:1rem 0}
    .field-table th,.field-table td{border:1px solid #ddd;padding:8px;font-size:13px;text-align:left}
    .field-table th{background:#f0f6fb;font-weight:600}
    .business-rule{background:#fffbea;border-left:4px solid #ffc107;padding:12px;margin:1rem 0}
  </style>
</head>
<body>
  <div class="container">
    <h1>Phase 4 — Functional Requirements (Billing)</h1>
    <p><strong>Scope:</strong> WS4 — Billing (Invoice management and billing schedule migration). This phase handles invoice generation, payment tracking, and billing workflows.</p>
    <p>See also: <a href="requirements-mapping.html#WS4">WS4 Mapping</a> | <a href="requirements-phase4-technical.html">Phase 4 Technical LLD</a></p>

    <h2>Page: Invoice Manager</h2>
    <p>Create and manage customer invoices, track payment status.</p>

    <h3>Field-Level Requirements</h3>
    <table class="field-table">
      <thead>
        <tr>
          <th>Field Name</th>
          <th>UI Control</th>
          <th>Data Type</th>
          <th>Required</th>
          <th>Validation</th>
          <th>Placeholder/Tooltip</th>
          <th>Example</th>
          <th>Business Rule</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Invoice Number</td>
          <td>Text Input</td>
          <td>String (50)</td>
          <td>Yes</td>
          <td>Auto-generated or manual</td>
          <td>Unique invoice identifier</td>
          <td>INV-2024-001</td>
          <td>BR-I01</td>
        </tr>
        <tr>
          <td>Account</td>
          <td>Lookup</td>
          <td>Reference (Account)</td>
          <td>Yes</td>
          <td>Active account</td>
          <td>Select customer</td>
          <td>Acme Corp</td>
          <td>—</td>
        </tr>
        <tr>
          <td>Invoice Date</td>
          <td>Date Picker</td>
          <td>Date</td>
          <td>Yes</td>
          <td>Cannot be future date</td>
          <td>Date invoice generated</td>
          <td>2024-10-30</td>
          <td>—</td>
        </tr>
        <tr>
          <td>Due Date</td>
          <td>Date Picker</td>
          <td>Date</td>
          <td>Yes</td>
          <td>Must be &gt;= Invoice Date</td>
          <td>Payment due date</td>
          <td>2024-11-29</td>
          <td>BR-I02</td>
        </tr>
        <tr>
          <td>Amount</td>
          <td>Currency Input</td>
          <td>Decimal (18,2)</td>
          <td>Yes</td>
          <td>&gt; 0</td>
          <td>Invoice total</td>
          <td>1500.00</td>
          <td>—</td>
        </tr>
        <tr>
          <td>Status</td>
          <td>Dropdown</td>
          <td>Picklist</td>
          <td>Yes</td>
          <td>Draft | Sent | Paid | Overdue</td>
          <td>Invoice status</td>
          <td>Sent</td>
          <td>BR-I03</td>
        </tr>
      </tbody>
    </table>

    <h3>Business Rules</h3>
    <div class="business-rule">
      <strong>BR-I01: Invoice Number Generation</strong><br>
      Auto-generate using pattern <code>INV-{YYYY}-{Sequence}</code>. Allow manual override for migrated invoices.
    </div>
    <div class="business-rule">
      <strong>BR-I02: Due Date Calculation</strong><br>
      Default Due Date = Invoice Date + Payment Terms (configurable per account, default 30 days).
    </div>
    <div class="business-rule">
      <strong>BR-I03: Status Workflow</strong><br>
      Invoice status progresses: Draft → Sent → Paid. If Due Date passes and status is "Sent", automatically update to "Overdue" via scheduled job.
    </div>

    <h2>Page: Billing Schedule</h2>
    <p>Define recurring billing schedules for subscription products.</p>

    <h3>Field-Level Requirements</h3>
    <table class="field-table">
      <thead>
        <tr>
          <th>Field Name</th>
          <th>UI Control</th>
          <th>Data Type</th>
          <th>Required</th>
          <th>Validation</th>
          <th>Placeholder/Tooltip</th>
          <th>Example</th>
          <th>Business Rule</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Billing Frequency</td>
          <td>Dropdown</td>
          <td>Picklist</td>
          <td>Yes</td>
          <td>Monthly | Quarterly | Annually</td>
          <td>How often to bill</td>
          <td>Monthly</td>
          <td>BR-B01</td>
        </tr>
        <tr>
          <td>Next Billing Date</td>
          <td>Date Picker</td>
          <td>Date</td>
          <td>Yes</td>
          <td>Future date</td>
          <td>Next invoice generation date</td>
          <td>2024-12-01</td>
          <td>—</td>
        </tr>
      </tbody>
    </table>

    <h3>Business Rules</h3>
    <div class="business-rule">
      <strong>BR-B01: Billing Frequency Mapping</strong><br>
      CPQ billing frequency values map to Revenue Cloud: Monthly → MONTHLY, Quarterly → QUARTERLY, Annually → YEARLY. See <a href="requirements-mapping.html#value-maps">Value Maps</a>.
    </div>

    <hr>
    <p><em>For field mapping and transform rules, see <a href="requirements-mapping.html#WS4">WS4 — Billing</a>.</em></p>
  </div>
    <script>
        // Collapsible navigation functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Handle section headers - single click toggle
            const sectionHeaders = document.querySelectorAll('.nav-section-header');
            sectionHeaders.forEach(header => {
                const newHeader = header.cloneNode(true);
                header.parentNode.replaceChild(newHeader, header);
            });
            
            document.querySelectorAll('.nav-section-header').forEach(header => {
                header.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const content = this.nextElementSibling;
                    const isExpanded = this.classList.contains('expanded');
                    
                    if (isExpanded) {
                        this.classList.remove('expanded');
                        content.classList.remove('expanded');
                    } else {
                        this.classList.add('expanded');
                        content.classList.add('expanded');
                    }
                });
            });
            
            // Handle subsection headers - single click toggle
            const subsectionHeaders = document.querySelectorAll('.nav-subsection-header');
            subsectionHeaders.forEach(header => {
                const newHeader = header.cloneNode(true);
                header.parentNode.replaceChild(newHeader, header);
            });
            
            document.querySelectorAll('.nav-subsection-header').forEach(header => {
                header.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const content = this.nextElementSibling;
                    const isExpanded = this.classList.contains('expanded');
                    
                    if (isExpanded) {
                        this.classList.remove('expanded');
                        content.classList.remove('expanded');
                    } else {
                        this.classList.add('expanded');
                        content.classList.add('expanded');
                    }
                });
            });
            
            // Auto-expand section containing active link
            const activeLinks = document.querySelectorAll('.nav-link.active, .nav-subsection-link.active');
            activeLinks.forEach(link => {
                // Expand parent section
                let section = link.closest('.nav-section-content');
                if (section) {
                    section.classList.add('expanded');
                    section.previousElementSibling.classList.add('expanded');
                }
                
                // Expand parent subsection if exists
                let subsection = link.closest('.nav-subsection-content');
                if (subsection) {
                    subsection.classList.add('expanded');
                    subsection.previousElementSibling.classList.add('expanded');
                }
            });
        });
    </script>

    <script>
        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
            // Clone all section headers to remove any duplicate event listeners
            const sectionHeaders = document.querySelectorAll('.nav-section-header');
            sectionHeaders.forEach(header => {
                const newHeader = header.cloneNode(true);
                header.parentNode.replaceChild(newHeader, header);
            });
            
            // Clone all subsection headers
            const subsectionHeaders = document.querySelectorAll('.nav-subsection-header');
            subsectionHeaders.forEach(header => {
                const newHeader = header.cloneNode(true);
                header.parentNode.replaceChild(newHeader, header);
            });
            
            // Add click handlers to main section headers
            document.querySelectorAll('.nav-section-header').forEach(header => {
                header.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const content = this.nextElementSibling;
                    const isExpanded = this.classList.contains('expanded');
                    
                    if (isExpanded) {
                        this.classList.remove('expanded');
                        content.classList.remove('expanded');
                    } else {
                        this.classList.add('expanded');
                        content.classList.add('expanded');
                    }
                });
            });
            
            // Add click handlers to subsection headers
            document.querySelectorAll('.nav-subsection-header').forEach(header => {
                header.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const content = this.nextElementSibling;
                    const isExpanded = this.classList.contains('expanded');
                    
                    if (isExpanded) {
                        this.classList.remove('expanded');
                        content.classList.remove('expanded');
                    } else {
                        this.classList.add('expanded');
                        content.classList.add('expanded');
                    }
                });
            });
            
            // Auto-expand section containing active link
            const activeLink = document.querySelector('.nav-link.active, .nav-subsection-link.active');
            if (activeLink) {
                let parent = activeLink.parentElement;
                while (parent && !parent.classList.contains('sidebar')) {
                    if (parent.classList.contains('nav-section-content') || parent.classList.contains('nav-subsection-content')) {
                        parent.classList.add('expanded');
                        const header = parent.previousElementSibling;
                        if (header) {
                            header.classList.add('expanded');
                        }
                    }
                    parent = parent.parentElement;
                }
            }
        });
    </script>
</body>
</html>
