<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Dev3 Day 19: Deploy to Test Workflow - RevNova Onboarding</title>
    <link rel="stylesheet" href="../styles.css">
    <style>body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Ubuntu,sans-serif}.main-content{margin-left:280px;padding:2.5rem}.day-header{background:linear-gradient(135deg,#fa709a 0%,#fee140 100%);color:#fff;padding:1.5rem;border-radius:10px;margin-bottom:1rem}.step-card{background:#fff;border:1px solid #e0e0e0;padding:1rem;border-radius:8px;margin-bottom:1rem}.nav-buttons{display:flex;justify-content:space-between;margin-top:1.5rem}</style>
</head>
<body>
    <div class="main-content">
        <div class="day-header"><h1>Day 19: Deploy to Test Workflow</h1><p>Developer 3 ‚Äî DevOps & QA</p></div>

        <div class="step-card" style="background:#fffbea;border-left:4px solid #f59e0b;">
            <h2>‚ö†Ô∏è IMPORTANT: Start of Day Checklist</h2>
            <p><strong>Before starting today's work, run these commands:</strong></p>
            <div style="background:#2d2d2d;color:#f8f8f2;padding:1rem;border-radius:6px;font-family:monospace;margin:1rem 0;">
cd C:\Dev\RevNovaRepository<br>
git pull origin main
            </div>
            <p>This ensures you have the latest code from your teammates. Always pull before starting work!</p>
        </div>

        <div class="step-card" style="background:#e0f2fe;border-left:4px solid #0284c7;">
            <h2>ü§ñ Copy This Prompt for Your GitHub Copilot</h2>
            <p><strong>Paste into Copilot Chat:</strong></p>
            <div style="background:#2d2d2d;color:#f8f8f2;padding:1rem;border-radius:6px;font-family:monospace;margin:1rem 0;font-size:0.85rem;max-height:400px;overflow-y:auto;">
Day 19 - RevNova DevOps & QA Developer<br><br>
**PLATFORM:** Salesforce CPQ ‚Üí Revenue Cloud migration SaaS. 7-step wizard with AI field mapping.<br>
**TECH:** Docker, GitHub Actions, Playwright (E2E tests), Node.js 20<br>
**REQUIREMENTS:** docs/RevNovaRequirements/deployment-guide.html, testing-plan.html<br>
**MVP:** Week 4/5 (Nov 30). ‚úÖWeeks 1-3: Tests, CI/CD. üîÑWeek 4: Deploy workflows, health checks.<br><br>
**CONTEXT:** Days 16-18 built deploy workflow, secrets management, health check endpoints<br>
**TODAY:** Create separate test environment deployment workflow with E2E validation<br><br>
**TASKS:**<br>
1. Create .github/workflows/deploy-test.yml triggered by manual dispatch or tag push<br>
2. Configure TEST_DATABASE_URL, TEST_REDIS_URL secrets for staging environment<br>
3. Deploy to test server with docker-compose -f docker-compose.test.yml<br>
4. Run Playwright E2E tests against test environment (all 7 wizard steps)<br>
5. Generate deployment report with test results, health check status, deployment time<br>
6. Add workflow_dispatch input for version tag selection<br><br>
**E2E TESTS:** Connection flow, schema analysis, mapping wizard, validation, preview, execution<br><br>
**ACCEPTANCE:** Manual trigger deploys to test. E2E tests run. Report generated with pass/fail status.<br><br>
Guide me through creating test environment deployment workflow with E2E validation.
            </div>
        </div>

        <div class="step-card">
            <h2>üìã Objective</h2>
            <p>Create test environment deployment workflow with E2E validation.</p>
        </div>

        <div class="step-card">
            <h2>üöÄ Step 1: Create Test Environment Workflow</h2>
            <p>Create <code>.github/workflows/deploy-test.yml</code>:</p>
            <div style="background:#2d2d2d;color:#f8f8f2;padding:1rem;border-radius:6px;font-family:monospace;margin:1rem 0;font-size:0.85rem;">
name: Deploy to Test Environment<br><br>

on:<br>
&nbsp;&nbsp;workflow_dispatch:<br>
&nbsp;&nbsp;&nbsp;&nbsp;inputs:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;version:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;description: 'Version tag to deploy'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;required: true<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default: 'latest'<br>
&nbsp;&nbsp;push:<br>
&nbsp;&nbsp;&nbsp;&nbsp;tags:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 'v*-test'<br><br>

jobs:<br>
&nbsp;&nbsp;deploy:<br>
&nbsp;&nbsp;&nbsp;&nbsp;runs-on: ubuntu-latest<br>
&nbsp;&nbsp;&nbsp;&nbsp;steps:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- name: Checkout code<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uses: actions/checkout@v3<br><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- name: Deploy to test server<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;env:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATABASE_URL: ${{ secrets.TEST_DATABASE_URL }}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REDIS_URL: ${{ secrets.TEST_REDIS_URL }}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;run: |<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ssh ${{ secrets.TEST_SSH_USER }}@${{ secrets.TEST_SSH_HOST }} \<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"cd /app && \<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;git pull origin main && \<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.test.yml pull && \<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.test.yml up -d"<br><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- name: Wait for services<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;run: sleep 30<br><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- name: Run health checks<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id: health<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;run: |<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl -f http://${{ secrets.TEST_SSH_HOST }}/health<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl -f http://${{ secrets.TEST_SSH_HOST }}/health/db<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl -f http://${{ secrets.TEST_SSH_HOST }}/health/redis
            </div>
        </div>

        <div class="step-card">
            <h2>üß™ Step 2: Add E2E Test Job</h2>
            <p>Add E2E test job to <code>deploy-test.yml</code>:</p>
            <div style="background:#2d2d2d;color:#f8f8f2;padding:1rem;border-radius:6px;font-family:monospace;margin:1rem 0;font-size:0.85rem;">
&nbsp;&nbsp;e2e-tests:<br>
&nbsp;&nbsp;&nbsp;&nbsp;needs: deploy<br>
&nbsp;&nbsp;&nbsp;&nbsp;runs-on: ubuntu-latest<br>
&nbsp;&nbsp;&nbsp;&nbsp;steps:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- name: Checkout code<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uses: actions/checkout@v3<br><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- name: Install dependencies<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;run: |<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd frontend<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;npm install<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;npx playwright install --with-deps<br><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- name: Run E2E tests<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;env:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BASE_URL: http://${{ secrets.TEST_SSH_HOST }}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;run: |<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd frontend<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;npm run test:e2e<br><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- name: Upload test results<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if: always()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uses: actions/upload-artifact@v3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: playwright-report<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path: frontend/playwright-report/<br><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- name: Generate deployment report<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if: always()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;run: |<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo "## Deployment Report" > report.md<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo "- Environment: Test" >> report.md<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo "- Version: ${{ github.event.inputs.version }}" >> report.md<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo "- Timestamp: $(date)" >> report.md<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo "- E2E Tests: ${{ job.status }}" >> report.md<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cat report.md
            </div>
        </div>

        <div class="step-card">
            <h2>üê≥ Step 3: Create Test Docker Compose</h2>
            <p>Create <code>docker-compose.test.yml</code>:</p>
            <div style="background:#2d2d2d;color:#f8f8f2;padding:1rem;border-radius:6px;font-family:monospace;margin:1rem 0;font-size:0.85rem;">
version: '3.8'<br><br>

services:<br>
&nbsp;&nbsp;postgres:<br>
&nbsp;&nbsp;&nbsp;&nbsp;image: postgres:16<br>
&nbsp;&nbsp;&nbsp;&nbsp;environment:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;POSTGRES_DB: revnova_test<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;POSTGRES_USER: testuser<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;POSTGRES_PASSWORD: ${TEST_DB_PASSWORD}<br>
&nbsp;&nbsp;&nbsp;&nbsp;ports:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- "5432:5432"<br><br>

&nbsp;&nbsp;redis:<br>
&nbsp;&nbsp;&nbsp;&nbsp;image: redis:7<br>
&nbsp;&nbsp;&nbsp;&nbsp;ports:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- "6379:6379"<br><br>

&nbsp;&nbsp;backend:<br>
&nbsp;&nbsp;&nbsp;&nbsp;build: ./backend<br>
&nbsp;&nbsp;&nbsp;&nbsp;environment:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATABASE_URL: ${TEST_DATABASE_URL}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REDIS_URL: redis://redis:6379<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NODE_ENV: test<br>
&nbsp;&nbsp;&nbsp;&nbsp;ports:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- "3000:3000"<br>
&nbsp;&nbsp;&nbsp;&nbsp;depends_on:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- postgres<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- redis<br><br>

&nbsp;&nbsp;frontend:<br>
&nbsp;&nbsp;&nbsp;&nbsp;build: ./frontend<br>
&nbsp;&nbsp;&nbsp;&nbsp;ports:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- "5173:5173"<br>
&nbsp;&nbsp;&nbsp;&nbsp;depends_on:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- backend
            </div>
        </div>

        <div class="step-card">
            <h2>üîê Step 4: Add Test Environment Secrets</h2>
            <p>Add secrets to GitHub repository (Settings ‚Üí Secrets ‚Üí Actions):</p>
            <div style="background:#fffbea;border-left:4px solid #f59e0b;padding:1rem;border-radius:6px;margin:1rem 0;">
<strong>Test Environment Secrets:</strong><br>
‚Ä¢ TEST_SSH_HOST: staging.revnova.example.com<br>
‚Ä¢ TEST_SSH_USER: deploy<br>
‚Ä¢ TEST_DATABASE_URL: postgresql://testuser:pass@localhost:5432/revnova_test<br>
‚Ä¢ TEST_REDIS_URL: redis://localhost:6379<br>
‚Ä¢ TEST_DB_PASSWORD: [secure password]<br><br>

<strong>Rotation Schedule:</strong><br>
‚Ä¢ TEST_DB_PASSWORD: Every 90 days<br>
‚Ä¢ SSH credentials: Review every 180 days
            </div>
        </div>

        <div class="step-card">
            <h2>‚úÖ End of Day 19 Checklist</h2>
            <ul>
                <li>‚úÖ deploy-test.yml workflow created with manual dispatch trigger</li>
                <li>‚úÖ Workflow accepts version input for deployment selection</li>
                <li>‚úÖ docker-compose.test.yml configured for test environment</li>
                <li>‚úÖ E2E test job runs Playwright tests against deployed test env</li>
                <li>‚úÖ Deployment report generated with version, timestamp, test status</li>
                <li>‚úÖ Test environment secrets added to GitHub (TEST_DATABASE_URL, etc.)</li>
                <li>‚úÖ Health checks validate successful deployment</li>
                <li>‚úÖ Committed: <code>feat(devops): add test environment deployment workflow with E2E validation</code></li>
            </ul>
        </div>
        <div class="nav-buttons"><a href="dev3-day18.html" class="nav-btn back">‚Üê Back to Day 18</a><a href="dev3-day20.html" class="nav-btn next">Next: Day 20 ‚Üí</a></div>
    </div>
</body>
</html>
